<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="btn-group-vertical col-sm-3"></div>
        <div class="barChart col-sm-9"></div>
    </div>
</div>
<script src="lib/d3v5.min.js"></script>
<script src="lib/jQuery.js"></script>
<script src="lib/bootstrap.min.js"></script>
<script>
    $(document).ready(function() {
        generateButtons();
        drawBarChart();
    });

    function generateButtons() {
        let btnGroup = $('.btn-group-vertical');
        d3.json('data/diseases.json').then(function(data){
            data.forEach(function(obj) {
                btnGroup.append('<button class="btn btn-outline-primary">'+obj.name+'</button>');
            })
        })
    }

    function drawBarChart() {
        let margin = {top: 20, right: 20, bottom: 500, left: 100};
        let container = d3.select('.barChart')
            .append('svg')
            .attr('width', 900)
            .attr('height', 1000);
        let width = +container.attr("width") - margin.left - margin.right;
        let height = +container.attr("height") - margin.top - margin.bottom;
        let x = d3.scaleBand().rangeRound([0, width]).padding(0.1);
        let y = d3.scaleLinear().rangeRound([height, 0]);
        d3.csv('data/data1.csv').then(function(data) {
            let compare = function (prop) {
                return function (obj1, obj2) {
                    let val1 = obj1[prop];
                    let val2 = obj2[prop];
                    if (!isNaN(Number(val1)) && !isNaN(Number(val2))) {
                        val1 = Number(val1);
                        val2 = Number(val2);
                    }
                    if (val1 < val2) {
                        return 1;
                    } else if (val1 > val2) {
                        return -1;
                    } else {
                        return 0;
                    }
                }
            };
            data = data.sort(compare("Total"));
            x.domain(data.map(d => d.Description));
            y.domain([0, d3.max(data, d => parseFloat(d.Total))]);
            let g = container.append('g')
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            g.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-55)");

            g.append("g")
                .attr("class", "axis axis--y")
                .call(d3.axisLeft(y));

            g.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.Description))
                .attr("y", d => y(d.Total))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.Total));
        })
    }
</script>
</body>
</html>